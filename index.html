<script>
  const tileSize = 32;
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const level = [
    // your level layout...
  ];

  const tileColors = {
    '#': '#444',
    ' ': '#aee7ff',
    'S': '#0f0',
    'F': '#f00',
    'o': '#ff0',
    '>': '#0ff',
    '<': '#0ff',
    '*': '#f0f'
  };

  const player = {
    x: 0,
    y: 0,
    width: tileSize * 0.8,
    height: tileSize * 0.8,
    color: '#00f',
    dx: 0,
    dy: 0,
    speed: 2.5,
    jumpPower: 13,
    grounded: false,
    colliding: false // new flag
  };

  let cameraX = 0;
  let cameraY = 0;

  // Find spawn position
  for (let y = 0; y < level.length; y++) {
    for (let x = 0; x < level[y].length; x++) {
      if (level[y][x] === 'S') {
        player.x = x * tileSize;
        player.y = y * tileSize;
      }
    }
  }

  const keys = {
    left: false,
    right: false,
    jump: false
  };

  document.querySelector('.left').addEventListener('touchstart', () => keys.left = true);
  document.querySelector('.left').addEventListener('touchend', () => keys.left = false);
  document.querySelector('.right').addEventListener('touchstart', () => keys.right = true);
  document.querySelector('.right').addEventListener('touchend', () => keys.right = false);
  document.querySelector('.jump').addEventListener('touchstart', () => {
    if (player.grounded) {
      player.dy = -player.jumpPower;
      player.grounded = false;
    }
  });

  function updatePlayer() {
    player.dx = 0;
    if (keys.left) player.dx = -player.speed;
    if (keys.right) player.dx = player.speed;

    player.dy += 0.4; // gravity

    player.x += player.dx;
    if (checkCollision(player.x, player.y)) {
      player.x -= player.dx;
    }

    player.y += player.dy;
    player.colliding = false;
    if (checkCollision(player.x, player.y)) {
      player.y -= player.dy;
      player.colliding = true;
      if (player.dy > 0) {
        player.grounded = true;
      }
      player.dy = 0;
    } else {
      player.grounded = false;
    }
  }

  function checkCollision(x, y) {
    const corners = [
      [x, y],
      [x + player.width, y],
      [x, y + player.height],
      [x + player.width, y + player.height]
    ];

    for (const [cx, cy] of corners) {
      const tx = Math.floor(cx / tileSize);
      const ty = Math.floor(cy / tileSize);
      if (level[ty] && level[ty][tx] && level[ty][tx] === '#') {
        return true;
      }
    }
    return false;
  }

  function drawLevel() {
    for (let y = 0; y < level.length; y++) {
      for (let x = 0; x < level[y].length; x++) {
        const char = level[y][x];
        const color = tileColors[char] || '#000';
        ctx.fillStyle = color;
        ctx.fillRect(x * tileSize - cameraX, y * tileSize - cameraY, tileSize, tileSize);
      }
    }
  }

  function drawPlayer() {
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x - cameraX, player.y - cameraY, player.width, player.height);
  }

  function updateCamera() {
    const targetX = player.x + player.width / 2 - canvas.width / 2;
    const targetY = player.y + player.height / 2 - canvas.height / 2;
    cameraX += (targetX - cameraX) * 0.05;
    cameraY += (targetY - cameraY) * 0.05;
  }

  // === DEBUG COUNTERS ===
  const debugBox = document.getElementById('debugInfo');
  let lastTime = performance.now();
  let fps = 0;

  function updateDebugInfo() {
    const now = performance.now();
    const delta = now - lastTime;
    fps = Math.round(1000 / delta);
    lastTime = now;

    let memStr = "N/A";
    if (performance.memory) {
      const used = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
      const total = (performance.memory.totalJSHeapSize / 1024 / 1024).toFixed(2);
      memStr = `${used} / ${total} MB`;
    }

    debugBox.innerHTML = `
      FPS: ${fps}<br>
      Memory: ${memStr}<br>
      X: ${player.x.toFixed(1)}<br>
      Y: ${player.y.toFixed(1)}<br>
      dy: ${player.dy.toFixed(2)}<br>
      Grounded: ${player.grounded}<br>
      Colliding: ${player.colliding}
    `;
  }

  function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    updatePlayer();
    updateCamera();
    drawLevel();
    drawPlayer();
    updateDebugInfo();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script
